Content-Type: text/x-zim-wiki
Wiki-Format: zim 0.4
Creation-Date: 2015-11-04T15:11:04+08:00

====== exim4 ======
Created Wednesday 04 November 2015

#openssl genrsa -out dkim.private.key 1024
#openssl rsa -in dkim.private.key -out dkim.public.key -pubout -outform PEM


hide mysql_servers = localhost/mail/root/root
MAIN_LOCAL_DOMAINS = localhost:wcce.cn:peop.gov.cn:netsnail.com
CHECK_DATA_LOCAL_ACL_FILE = /etc/exim4/conf.d/local-acl
MAIN_TLS_ENABLE = true
tls_on_connect_ports=465
daemon_smtp_ports = smtp : 587
MESSAGE_SIZE_LIMIT = 100M
AUTH_SERVER_ALLOW_NOTLS_PASSWORDS = false
MAIN_IGNORE_BOUNCE_ERRORS_AFTER=1d
DKIM_DOMAIN=wcce.cn
DKIM_SELECTOR=x
DKIM_PRIVATE_KEY=/etc/exim4/dkim.private.key
DKIM_CANON=relaxed

### router/mmm_mail4root
# tiger
virtual_user:
  debug_print = "R: virtual_user for $local_part@$domain"
  driver = redirect
  allow_fail
  allow_defer
  domains = +local_domains
  condition = ${if eq{}{${lookup mysql{select email from users where email='${local_part}@${domain}'}}}{no}{yes}}
  data = /mail/${domain}/${local_part}
  file_transport = virtual_directory

### transport/35_exim4-config_address_directory
virtual_directory:
  debug_print = "T: virtual_directory for $local_part@$domain"
  driver = appendfile
  quota = 5000M
  quota_warn_threshold = 90%
  directory = /mail/$domain/$local_part
  user = Debian-exim
  group = Debian-exim
  quota_is_inclusive = false
  maildir_tag = ,S=$message_size
  quota_size_regex = ,S=(\d+):
  maildir_use_size_file = true
  quota_warn_message = "To: $local_part@$domain\n\
						Subject: Mailbox quota warning\n\n\
						This message was automatically generated by the mail delivery software.\n\n\
						You are now using over 75% of your allocated mail storage quota.\n\n\
						If your mailbox fills completely, further incoming messages will be automatically\n\
						returned to their senders.\n\n\
						Please take note of this and remove unwanted mail from your mailbox.\n"
  mode = 0660
  directory_mode = 0770
  delivery_date_add
  envelope_to_add
  return_path_add
  check_string = ""
  escape_string = ""
  maildir_format
#  quota = ${lookup mysql {select quota from users where email='${local_part}@${domain}'}{$value}}
#  directory = ${lookup mysql {SELECT CONCAT('/mail/',SUBSTRING_INDEX(email,'@',-1),'/',SUBSTRING_INDEX(email,'@',1),'/') FROM users WHERE email='${local_part}@${domain}'}{$value}}


